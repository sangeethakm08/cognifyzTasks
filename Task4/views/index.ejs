<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Form with Dynamic Validation</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #a8e6cf 0%, #dcedc8 100%);
      --accent-gradient: linear-gradient(135deg, #7fcdbb 0%, #a8e6cf 100%);
      --text-dark: #2d5016;
      --shadow-soft: 0 8px 32px 0 rgba(127, 205, 187, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--primary-gradient);
      min-height: 100vh;
      padding: 40px 20px;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(168, 230, 207, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(127, 205, 187, 0.3) 0%, transparent 50%);
      z-index: 0;
    }

    .main-container {
      max-width: 900px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .hero-section {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.75) 100%);
      backdrop-filter: blur(25px);
      border: 2px solid rgba(45, 80, 22, 0.2);
      border-radius: 28px;
      padding: 40px;
      text-align: center;
      margin-bottom: 30px;
      box-shadow: var(--shadow-soft);
    }

    .hero-section h1 {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #2d5016 0%, #4a7c2a 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }

    .hero-section p {
      color: #2d5016;
      font-size: 1.1rem;
    }

    .form-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 0%, rgba(255, 255, 255, 0.75) 100%);
      backdrop-filter: blur(25px);
      border: 2px solid rgba(45, 80, 22, 0.2);
      border-radius: 28px;
      padding: 45px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 30px;
    }

    .form-section-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #2d5016;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(45, 80, 22, 0.2);
    }

    .form-group-wrapper {
      margin-bottom: 25px;
      position: relative;
    }

    .form-label {
      font-weight: 600;
      color: #2d5016;
      margin-bottom: 8px;
      font-size: 0.9rem;
      display: block;
    }

    .form-label .required {
      color: #ff6b6b;
      margin-left: 4px;
    }

    .form-control,
    .form-select {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.8) 100%);
      border: 2px solid rgba(45, 80, 22, 0.2);
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 0.9rem;
      color: #2d5016;
      transition: all 0.3s ease;
      width: 100%;
    }

    .form-control:focus,
    .form-select:focus {
      background: rgba(255, 255, 255, 1);
      border-color: rgba(45, 80, 22, 0.5);
      box-shadow: 0 0 0 4px rgba(127, 205, 187, 0.2);
      outline: none;
    }

    .form-control.valid {
      border-color: #51cf66;
    }

    .form-control.invalid {
      border-color: #ff6b6b;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 0.85rem;
      margin-top: 6px;
      display: block;
      animation: shake 0.5s ease;
    }

    .success-message {
      color: #51cf66;
      font-size: 0.85rem;
      margin-top: 6px;
      display: block;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Password Strength Indicator */
    .password-strength-container {
      margin-top: 10px;
    }

    .password-strength-bar {
      height: 6px;
      background: rgba(45, 80, 22, 0.1);
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 8px;
    }

    .password-strength-fill {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
      border-radius: 3px;
    }

    .password-strength-fill.weak {
      width: 33%;
      background: #ff6b6b;
    }

    .password-strength-fill.medium {
      width: 66%;
      background: #ffd93d;
    }

    .password-strength-fill.strong {
      width: 100%;
      background: #51cf66;
    }

    .password-strength-text {
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 5px;
    }

    .password-requirements {
      list-style: none;
      padding: 0;
      margin-top: 8px;
    }

    .password-requirements li {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .password-requirements li.valid {
      color: #51cf66;
    }

    .password-requirements li.invalid {
      color: #ff6b6b;
    }

    .password-requirements li i {
      font-size: 0.7rem;
    }

    /* Dynamic Field Container */
    .dynamic-field-container {
      margin-top: 15px;
      padding: 15px;
      background: rgba(127, 205, 187, 0.1);
      border-radius: 12px;
      border: 2px dashed rgba(45, 80, 22, 0.2);
      display: none;
    }

    .dynamic-field-container.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Progress Indicator */
    .form-progress {
      margin-bottom: 30px;
      padding: 20px;
      background: rgba(127, 205, 187, 0.1);
      border-radius: 12px;
      display: none;
    }

    .form-progress.show {
      display: block;
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .progress-step {
      flex: 1;
      text-align: center;
      font-size: 0.85rem;
      color: #666;
      position: relative;
    }

    .progress-step.active {
      color: #2d5016;
      font-weight: 600;
    }

    .progress-step.completed {
      color: #51cf66;
    }

    .progress-bar-container {
      height: 6px;
      background: rgba(45, 80, 22, 0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: var(--accent-gradient);
      transition: width 0.3s ease;
      width: 0%;
    }

    /* Submit Button */
    .submit-button {
      background: var(--accent-gradient);
      border: none;
      border-radius: 14px;
      padding: 14px 50px;
      font-size: 0.95rem;
      font-weight: 700;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.4s ease;
      box-shadow: 0 8px 24px rgba(127, 205, 187, 0.4);
      width: 100%;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .submit-button:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(127, 205, 187, 0.5);
    }

    .submit-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Real-time Validation Indicator */
    .validation-indicator {
      position: absolute;
      right: 12px;
      top: 38px;
      font-size: 1.2rem;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .validation-indicator.show {
      opacity: 1;
    }

    .validation-indicator.valid {
      color: #51cf66;
    }

    .validation-indicator.invalid {
      color: #ff6b6b;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .form-card {
        padding: 30px 20px;
      }

      .hero-section h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="hero-section">
      <h1><i class="bi bi-shield-check"></i> Advanced Form Validation</h1>
      <p>Complex validation with dynamic DOM manipulation</p>
    </div>

    <div class="form-progress" id="formProgress">
      <div class="progress-steps">
        <div class="progress-step completed" id="step1">Personal Info</div>
        <div class="progress-step active" id="step2">Account Details</div>
        <div class="progress-step" id="step3">Additional Info</div>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
      </div>
    </div>

    <div class="form-card">
      <h2 class="form-section-title">Registration Form</h2>
      
      <form method="POST" action="/process-form" id="contactForm" novalidate>
        <!-- Name Field -->
        <div class="form-group-wrapper">
          <label for="name" class="form-label">
            Full Name
            <span class="required">*</span>
          </label>
          <div style="position: relative;">
            <input 
              type="text" 
              class="form-control" 
              id="name" 
              name="name" 
              placeholder="Enter your full name"
              value="<%= typeof submittedData !== 'undefined' && submittedData ? submittedData.userNameField : '' %>"
              required>
            <span class="validation-indicator" id="nameIndicator">
              <i class="bi bi-check-circle-fill valid"></i>
              <i class="bi bi-x-circle-fill invalid"></i>
            </span>
          </div>
          <span class="error-message" id="nameError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.name ? submissionErrors.name : '' %>
          </span>
          <span class="success-message" id="nameSuccess" style="display: none;"></span>
        </div>

        <!-- Email Field -->
        <div class="form-group-wrapper">
          <label for="email" class="form-label">
            Email Address
            <span class="required">*</span>
          </label>
          <div style="position: relative;">
            <input 
              type="email" 
              class="form-control" 
              id="email" 
              name="email"
              placeholder="your.email@example.com"
              value="<%= typeof submittedData !== 'undefined' && submittedData ? submittedData.userEmailField : '' %>"
              required>
            <span class="validation-indicator" id="emailIndicator">
              <i class="bi bi-check-circle-fill valid"></i>
              <i class="bi bi-x-circle-fill invalid"></i>
            </span>
          </div>
          <span class="error-message" id="emailError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.email ? submissionErrors.email : '' %>
          </span>
          <span class="success-message" id="emailSuccess" style="display: none;"></span>
        </div>

        <!-- Phone Field -->
        <div class="form-group-wrapper">
          <label for="phone" class="form-label">
            Phone Number
            <span class="required">*</span>
          </label>
          <div style="position: relative;">
            <input 
              type="tel" 
              class="form-control" 
              id="phone" 
              name="phone"
              placeholder="+1 (555) 123-4567"
              value="<%= typeof submittedData !== 'undefined' && submittedData ? submittedData.userPhoneField : '' %>"
              required>
            <span class="validation-indicator" id="phoneIndicator">
              <i class="bi bi-check-circle-fill valid"></i>
              <i class="bi bi-x-circle-fill invalid"></i>
            </span>
          </div>
          <span class="error-message" id="phoneError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.phone ? submissionErrors.phone : '' %>
          </span>
          <span class="success-message" id="phoneSuccess" style="display: none;"></span>
        </div>

        <!-- Password Field with Strength Indicator -->
        <div class="form-group-wrapper">
          <label for="password" class="form-label">
            Password
            <span class="required">*</span>
          </label>
          <div style="position: relative;">
            <input 
              type="password" 
              class="form-control" 
              id="password" 
              name="password"
              placeholder="Create a strong password"
              required>
            <span class="validation-indicator" id="passwordIndicator">
              <i class="bi bi-check-circle-fill valid"></i>
              <i class="bi bi-x-circle-fill invalid"></i>
            </span>
          </div>
          
          <div class="password-strength-container" id="passwordStrengthContainer" style="display: none;">
            <div class="password-strength-text" id="passwordStrengthText">Password Strength: <span id="strengthLabel">Weak</span></div>
            <div class="password-strength-bar">
              <div class="password-strength-fill" id="passwordStrengthFill"></div>
            </div>
            <ul class="password-requirements" id="passwordRequirements">
              <li id="reqLength"><i class="bi bi-circle"></i> At least 8 characters</li>
              <li id="reqLowercase"><i class="bi bi-circle"></i> One lowercase letter</li>
              <li id="reqUppercase"><i class="bi bi-circle"></i> One uppercase letter</li>
              <li id="reqNumber"><i class="bi bi-circle"></i> One number</li>
              <li id="reqSpecial"><i class="bi bi-circle"></i> One special character</li>
            </ul>
          </div>
          
          <span class="error-message" id="passwordError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.password ? submissionErrors.password : '' %>
          </span>
        </div>

        <!-- Confirm Password -->
        <div class="form-group-wrapper">
          <label for="confirmPassword" class="form-label">
            Confirm Password
            <span class="required">*</span>
          </label>
          <div style="position: relative;">
            <input 
              type="password" 
              class="form-control" 
              id="confirmPassword" 
              name="confirmPassword"
              placeholder="Re-enter your password"
              required>
            <span class="validation-indicator" id="confirmPasswordIndicator">
              <i class="bi bi-check-circle-fill valid"></i>
              <i class="bi bi-x-circle-fill invalid"></i>
            </span>
          </div>
          <span class="error-message" id="confirmPasswordError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.confirmPassword ? submissionErrors.confirmPassword : '' %>
          </span>
        </div>

        <!-- Date of Birth -->
        <div class="form-group-wrapper">
          <label for="dob" class="form-label">
            Date of Birth
            <span class="required">*</span>
          </label>
          <input 
            type="date" 
            class="form-control" 
            id="dob" 
            name="dob"
            value="<%= typeof submittedData !== 'undefined' && submittedData ? submittedData.userDOBField : '' %>"
            required>
          <span class="error-message" id="dobError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.dob ? submissionErrors.dob : '' %>
          </span>
        </div>

        <!-- Gender -->
        <div class="form-group-wrapper">
          <label for="gender" class="form-label">
            Gender
            <span class="required">*</span>
          </label>
          <select class="form-select" id="gender" name="gender" required>
            <option value="">Select your gender</option>
            <option value="Male" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userGenderField === 'Male' ? 'selected' : '' %>>Male</option>
            <option value="Female" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userGenderField === 'Female' ? 'selected' : '' %>>Female</option>
            <option value="Other" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userGenderField === 'Other' ? 'selected' : '' %>>Other</option>
          </select>
          <span class="error-message" id="genderError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.gender ? submissionErrors.gender : '' %>
          </span>
        </div>

        <!-- Country -->
        <div class="form-group-wrapper">
          <label for="country" class="form-label">
            Country
            <span class="required">*</span>
          </label>
          <select class="form-select" id="country" name="country" required>
            <option value="">Select your country</option>
            <option value="USA" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'USA' ? 'selected' : '' %>>United States</option>
            <option value="UK" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'UK' ? 'selected' : '' %>>United Kingdom</option>
            <option value="Canada" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'Canada' ? 'selected' : '' %>>Canada</option>
            <option value="India" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'India' ? 'selected' : '' %>>India</option>
            <option value="Australia" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'Australia' ? 'selected' : '' %>>Australia</option>
            <option value="Other" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userCountryField === 'Other' ? 'selected' : '' %>>Other</option>
          </select>
          <span class="error-message" id="countryError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.country ? submissionErrors.country : '' %>
          </span>
        </div>

        <!-- Occupation -->
        <div class="form-group-wrapper">
          <label for="occupation" class="form-label">
            Occupation
            <span class="required">*</span>
          </label>
          <select class="form-select" id="occupation" name="occupation" required>
            <option value="">Select your occupation</option>
            <option value="Software Engineer" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Software Engineer' ? 'selected' : '' %>>Software Engineer</option>
            <option value="Data Scientist" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Data Scientist' ? 'selected' : '' %>>Data Scientist</option>
            <option value="Product Manager" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Product Manager' ? 'selected' : '' %>>Product Manager</option>
            <option value="Designer" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Designer' ? 'selected' : '' %>>Designer</option>
            <option value="Student" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Student' ? 'selected' : '' %>>Student</option>
            <option value="Other" <%= typeof submittedData !== 'undefined' && submittedData && submittedData.userOccupationField === 'Other' ? 'selected' : '' %>>Other</option>
          </select>
          <span class="error-message" id="occupationError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.occupation ? submissionErrors.occupation : '' %>
          </span>
        </div>

        <!-- Dynamic Field Container (shown based on occupation) -->
        <div class="dynamic-field-container" id="dynamicFieldContainer">
          <label for="company" class="form-label">Company/Organization</label>
          <input type="text" class="form-control" id="company" name="company" placeholder="Enter company name">
        </div>

        <!-- Message -->
        <div class="form-group-wrapper">
          <label for="message" class="form-label">
            Message
            <span class="required">*</span>
          </label>
          <textarea 
            class="form-control" 
            id="message" 
            name="message" 
            rows="4"
            placeholder="Enter your message (minimum 10 characters)"
            required><%= typeof submittedData !== 'undefined' && submittedData ? submittedData.userMessageField : '' %></textarea>
          <span class="error-message" id="messageError">
            <%- typeof submissionErrors !== 'undefined' && submissionErrors && submissionErrors.message ? submissionErrors.message : '' %>
          </span>
        </div>

        <!-- Submit Button -->
        <div class="form-group-wrapper" style="margin-top: 30px;">
          <button type="submit" class="submit-button" id="submitBtn">
            Submit Form
          </button>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // Client-side routing
    class Router {
      constructor() {
        this.routes = {};
        this.currentRoute = '';
        this.init();
      }

      init() {
        window.addEventListener('hashchange', () => this.handleRoute());
        this.handleRoute();
      }

      addRoute(path, handler) {
        this.routes[path] = handler;
      }

      handleRoute() {
        const hash = window.location.hash.slice(1) || 'home';
        this.currentRoute = hash;
        
        if (this.routes[hash]) {
          this.routes[hash]();
        } else {
          this.routes['home']();
        }
      }

      navigate(path) {
        window.location.hash = path;
      }
    }

    const router = new Router();

    // Form Validation and DOM Manipulation
    class FormValidator {
      constructor() {
        this.form = document.getElementById('contactForm');
        this.fields = {
          name: document.getElementById('name'),
          email: document.getElementById('email'),
          phone: document.getElementById('phone'),
          password: document.getElementById('password'),
          confirmPassword: document.getElementById('confirmPassword'),
          dob: document.getElementById('dob'),
          gender: document.getElementById('gender'),
          country: document.getElementById('country'),
          occupation: document.getElementById('occupation'),
          message: document.getElementById('message')
        };
        this.init();
      }

      init() {
        // Real-time validation on input
        Object.keys(this.fields).forEach(fieldName => {
          const field = this.fields[fieldName];
          if (field) {
            field.addEventListener('blur', () => this.validateField(fieldName));
            field.addEventListener('input', () => {
              if (fieldName === 'password') {
                this.checkPasswordStrength();
              } else if (fieldName === 'confirmPassword') {
                this.validatePasswordMatch();
              } else {
                this.validateField(fieldName, true);
              }
            });
          }
        });

        // Dynamic field based on occupation
        if (this.fields.occupation) {
          this.fields.occupation.addEventListener('change', () => {
            this.handleOccupationChange();
          });
        }

        // Form submission
        this.form.addEventListener('submit', (e) => this.handleSubmit(e));

        // Update progress on field focus
        Object.values(this.fields).forEach(field => {
          if (field) {
            field.addEventListener('focus', () => this.updateProgress());
          }
        });
      }

      validateField(fieldName, realTime = false) {
        const field = this.fields[fieldName];
        if (!field) return true;

        const value = field.value.trim();
        const errorElement = document.getElementById(`${fieldName}Error`);
        const successElement = document.getElementById(`${fieldName}Success`);
        const indicator = document.getElementById(`${fieldName}Indicator`);
        let isValid = true;
        let errorMessage = '';

        switch (fieldName) {
          case 'name':
            if (!value || value.length < 2) {
              isValid = false;
              errorMessage = 'Name must contain at least 2 characters.';
            } else if (!/^[a-zA-Z\s]+$/.test(value)) {
              isValid = false;
              errorMessage = 'Name can only contain letters and spaces.';
            }
            break;

          case 'email':
            const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            if (!value || !emailPattern.test(value)) {
              isValid = false;
              errorMessage = 'Please enter a valid email address.';
            }
            break;

          case 'phone':
            const phoneDigits = value.replace(/\D/g, '');
            if (!value || phoneDigits.length < 10) {
              isValid = false;
              errorMessage = 'Phone number must contain at least 10 digits.';
            }
            break;

          case 'password':
            if (!value || value.length < 8) {
              isValid = false;
              errorMessage = 'Password must be at least 8 characters long.';
            } else {
              const strength = this.checkPasswordStrength();
              if (strength.score < 3) {
                isValid = false;
                errorMessage = 'Password is too weak.';
              }
            }
            break;

          case 'confirmPassword':
            isValid = this.validatePasswordMatch();
            if (!isValid) {
              errorMessage = 'Passwords do not match.';
            }
            break;

          case 'dob':
            if (!value) {
              isValid = false;
              errorMessage = 'Date of birth is required.';
            } else {
              const dob = new Date(value);
              const today = new Date();
              const age = today.getFullYear() - dob.getFullYear();
              if (age < 18) {
                isValid = false;
                errorMessage = 'You must be at least 18 years old.';
              }
            }
            break;

          case 'gender':
          case 'country':
          case 'occupation':
            if (!value) {
              isValid = false;
              errorMessage = `Please select your ${fieldName}.`;
            }
            break;

          case 'message':
            if (!value || value.length < 10) {
              isValid = false;
              errorMessage = 'Message must contain at least 10 characters.';
            }
            break;
        }

        // Update UI
        if (isValid) {
          field.classList.remove('invalid');
          field.classList.add('valid');
          if (errorElement) errorElement.textContent = '';
          if (successElement && realTime) {
            successElement.textContent = 'Looks good!';
            successElement.style.display = 'block';
          }
          if (indicator) {
            indicator.classList.add('show', 'valid');
            indicator.querySelector('.valid').style.display = 'inline';
            indicator.querySelector('.invalid').style.display = 'none';
          }
        } else {
          field.classList.remove('valid');
          field.classList.add('invalid');
          if (errorElement) errorElement.textContent = errorMessage;
          if (successElement) successElement.style.display = 'none';
          if (indicator) {
            indicator.classList.add('show', 'invalid');
            indicator.querySelector('.valid').style.display = 'none';
            indicator.querySelector('.invalid').style.display = 'inline';
          }
        }

        return isValid;
      }

      checkPasswordStrength() {
        const password = this.fields.password.value;
        const container = document.getElementById('passwordStrengthContainer');
        const fill = document.getElementById('passwordStrengthFill');
        const label = document.getElementById('strengthLabel');
        
        if (!password) {
          container.style.display = 'none';
          return { score: 0, strength: 'weak' };
        }

        container.style.display = 'block';
        
        let score = 0;
        const requirements = {
          length: password.length >= 8,
          lowercase: /[a-z]/.test(password),
          uppercase: /[A-Z]/.test(password),
          number: /[0-9]/.test(password),
          special: /[^A-Za-z0-9]/.test(password)
        };

        // Update requirement indicators
        document.getElementById('reqLength').classList.toggle('valid', requirements.length);
        document.getElementById('reqLength').classList.toggle('invalid', !requirements.length);
        document.getElementById('reqLength').querySelector('i').className = requirements.length ? 'bi bi-check-circle-fill' : 'bi bi-circle';
        
        document.getElementById('reqLowercase').classList.toggle('valid', requirements.lowercase);
        document.getElementById('reqLowercase').classList.toggle('invalid', !requirements.lowercase);
        document.getElementById('reqLowercase').querySelector('i').className = requirements.lowercase ? 'bi bi-check-circle-fill' : 'bi bi-circle';
        
        document.getElementById('reqUppercase').classList.toggle('valid', requirements.uppercase);
        document.getElementById('reqUppercase').classList.toggle('invalid', !requirements.uppercase);
        document.getElementById('reqUppercase').querySelector('i').className = requirements.uppercase ? 'bi bi-check-circle-fill' : 'bi bi-circle';
        
        document.getElementById('reqNumber').classList.toggle('valid', requirements.number);
        document.getElementById('reqNumber').classList.toggle('invalid', !requirements.number);
        document.getElementById('reqNumber').querySelector('i').className = requirements.number ? 'bi bi-check-circle-fill' : 'bi bi-circle';
        
        document.getElementById('reqSpecial').classList.toggle('valid', requirements.special);
        document.getElementById('reqSpecial').classList.toggle('invalid', !requirements.special);
        document.getElementById('reqSpecial').querySelector('i').className = requirements.special ? 'bi bi-check-circle-fill' : 'bi bi-circle';

        Object.values(requirements).forEach(req => {
          if (req) score++;
        });

        let strength = 'weak';
        if (score >= 5) strength = 'strong';
        else if (score >= 3) strength = 'medium';

        fill.className = `password-strength-fill ${strength}`;
        label.textContent = strength.charAt(0).toUpperCase() + strength.slice(1);

        return { score, strength, requirements };
      }

      validatePasswordMatch() {
        const password = this.fields.password.value;
        const confirmPassword = this.fields.confirmPassword.value;
        const field = this.fields.confirmPassword;
        const errorElement = document.getElementById('confirmPasswordError');
        const indicator = document.getElementById('confirmPasswordIndicator');

        if (!confirmPassword) return false;

        const isValid = password === confirmPassword;

        if (isValid) {
          field.classList.remove('invalid');
          field.classList.add('valid');
          if (errorElement) errorElement.textContent = '';
          if (indicator) {
            indicator.classList.add('show', 'valid');
            indicator.querySelector('.valid').style.display = 'inline';
            indicator.querySelector('.invalid').style.display = 'none';
          }
        } else {
          field.classList.remove('valid');
          field.classList.add('invalid');
          if (errorElement) errorElement.textContent = 'Passwords do not match.';
          if (indicator) {
            indicator.classList.add('show', 'invalid');
            indicator.querySelector('.valid').style.display = 'none';
            indicator.querySelector('.invalid').style.display = 'inline';
          }
        }

        return isValid;
      }

      handleOccupationChange() {
        const occupation = this.fields.occupation.value;
        const dynamicContainer = document.getElementById('dynamicFieldContainer');
        
        // Show company field for certain occupations
        if (occupation && ['Software Engineer', 'Data Scientist', 'Product Manager', 'Designer'].includes(occupation)) {
          dynamicContainer.classList.add('show');
        } else {
          dynamicContainer.classList.remove('show');
        }
        
        this.updateProgress();
      }

      updateProgress() {
        const progressContainer = document.getElementById('formProgress');
        const progressBar = document.getElementById('progressBar');
        
        let completedFields = 0;
        const totalFields = Object.keys(this.fields).length;
        
        Object.values(this.fields).forEach(field => {
          if (field && field.value.trim() !== '') {
            completedFields++;
          }
        });

        const progress = (completedFields / totalFields) * 100;
        progressBar.style.width = `${progress}%`;
        
        if (completedFields > 0) {
          progressContainer.classList.add('show');
        }

        // Update step indicators
        if (completedFields <= 3) {
          document.getElementById('step1').classList.add('active');
          document.getElementById('step2').classList.remove('active', 'completed');
          document.getElementById('step3').classList.remove('active', 'completed');
        } else if (completedFields <= 7) {
          document.getElementById('step1').classList.remove('active');
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.add('active');
          document.getElementById('step3').classList.remove('active', 'completed');
        } else {
          document.getElementById('step1').classList.remove('active');
          document.getElementById('step1').classList.add('completed');
          document.getElementById('step2').classList.remove('active');
          document.getElementById('step2').classList.add('completed');
          document.getElementById('step3').classList.add('active');
        }
      }

      handleSubmit(e) {
        let isValid = true;
        
        // Validate all fields
        Object.keys(this.fields).forEach(fieldName => {
          if (!this.validateField(fieldName)) {
            isValid = false;
          }
        });

        if (!isValid) {
          e.preventDefault();
          // Scroll to first error
          const firstError = this.form.querySelector('.invalid');
          if (firstError) {
            firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
            firstError.focus();
          }
        } else {
          // Show loading state
          const submitBtn = document.getElementById('submitBtn');
          submitBtn.disabled = true;
          submitBtn.textContent = 'Submitting...';
        }
      }
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      const validator = new FormValidator();
      
      // Setup routing
      router.addRoute('home', () => {
        console.log('Home route');
      });
      
      router.addRoute('form', () => {
        console.log('Form route');
        document.getElementById('contactForm').scrollIntoView({ behavior: 'smooth' });
      });
    });
  </script>
</body>
</html>

